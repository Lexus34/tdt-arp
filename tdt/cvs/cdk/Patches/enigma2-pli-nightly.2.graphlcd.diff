diff -Nur '--exclude=.git' '--exclude=tuxtxt' enigma2-nightly.org/lib/gdi/lcd.h enigma2-nightly.patched/lib/gdi/lcd.h
--- enigma2-nightly/lib/gdi/lcd.h	2012-06-08 18:46:39.000000000 +0200
+++ enigma2-nightly.patched/lib/gdi/lcd.h	2012-06-09 13:11:32.617772095 +0200
@@ -4,6 +4,16 @@
 #include <asm/types.h>
 #include <lib/gdi/esize.h>
 #include <lib/gdi/erect.h>
+#ifdef __sh__
+#include <glcdgraphics/bitmap.h>
+#include <glcdgraphics/glcd.h>
+#include <glcdgraphics/image.h>
+#include <glcddrivers/config.h>
+#include <glcddrivers/driver.h>
+#include <glcddrivers/drivers.h>
+#include <glcdgraphics/extformats.h>
+#include <byteswap.h>
+#endif
 
 #define LCD_CONTRAST_MIN 0
 #define LCD_CONTRAST_MAX 63
@@ -48,6 +58,13 @@
 	unsigned char inverted;
 	bool flipped;
 	int is_oled;
+#ifdef __sh__
+	GLCD::cDriver * lcd;
+	GLCD::cBitmap * bitmap;
+	int displayNumber;
+	int depth;
+	int width, height;
+#endif
 #ifdef SWIG
 	eDBoxLCD();
 	~eDBoxLCD();
diff -Nur '--exclude=.git' '--exclude=tuxtxt' enigma2-nightly.org/main/Makefile.am enigma2-nightly.patched/main/Makefile.am
--- enigma2-nightly/main/Makefile.am	2012-06-08 23:51:26.700936103 +0200
+++ enigma2-nightly.patched/main/Makefile.am	2012-06-09 13:16:33.937777342 +0200
@@ -57,6 +57,8 @@
 
 enigma2_LDFLAGS = -Wl,--export-dynamic
 
+enigma2_LDADD += -lglcddrivers -lglcdgraphics -lglcdskin
+
 if HAVE_GIT_DIR
 GIT_DIR = $(top_srcdir)/.git
 GIT = git --git-dir=$(GIT_DIR)
diff -Nur '--exclude=.git' '--exclude=tuxtxt' enigma2-nightly/main/enigma.cpp enigma2-nightly.patched/main/enigma.cpp
--- enigma2-nightly/main/enigma.cpp	2012-06-08 23:49:29.136934051 +0200
+++ enigma2-nightly.patched/main/enigma.cpp	2012-06-09 13:19:11.433780085 +0200
@@ -168,7 +168,11 @@
 	eWidgetDesktop dsk_lcd(my_lcd_dc->size());
 
 	dsk.setStyleID(0);
-	dsk_lcd.setStyleID(my_lcd_dc->size().width() == 96 ? 2 : 1);
+#ifndef __sh__
+  	dsk_lcd.setStyleID(my_lcd_dc->size().width() == 96 ? 2 : 1);
+#else
+ 	dsk_lcd.setStyleID(my_lcd_dc->size().width() == 320 ? 1 : 2);
+#endif
 
 /*	if (double_buffer)
 	{
--- enigma2-nightly/data/skin_display.xml.org	2012-06-09 13:35:55.033276862 +0200
+++ enigma2-nightly/data/skin_display.xml	2012-06-09 15:17:23.396735768 +0200
@@ -32,17 +32,25 @@
 
 <!-- main-->
 	<screen name="InfoBarSummary" position="fill">
-		<widget source="session.CurrentService" render="Label" position="top" size="*,21" font="FdLcD;20" halign="left" noWrap="1">
+		<panel position="top" size="*,90">
+			<widget source="session.CurrentService" render="Picon" position="0,2" zPosition="1" size="130,90" alphatest="on">
+				<convert type="ServiceName">Reference</convert>
+			</widget>
+			<widget source="global.CurrentTime" render="Label" position="180,20" size="120,45" font="FdLcD;45" halign="right" valign="top">						
+				<convert type="ClockToText">Format:%H:%M</convert>
+			</widget>
+		</panel>
+		<widget source="session.CurrentService" render="Label" position="top" size="*,42" font="FdLcD;42" halign="left" noWrap="1">
 			<convert type="ServiceName">Name</convert>
 		</widget>
-		<widget source="session.Event_Now" render="Label" position="top" size="*,15" font="FdLcD;14" halign="left" noWrap="1">
+		<widget source="session.Event_Now" render="Label" position="top" size="*,33" font="FdLcD;33" halign="left" noWrap="1">
 			<convert type="EventName">Name</convert>
 		</widget>
-		<widget source="session.Event_Now" render="Progress" position="top" size="*,4" borderWidth="1" >
+		<widget source="session.Event_Now" render="Progress" position="bottom" size="*,14" borderWidth="1" >
 			<convert type="EventTime">Progress</convert>
 		</widget>
-		<panel position="bottom" size="*,24" name="SummaryClockPanel">
-			<widget source="session.Event_Now" render="Label" position="4,0" size="40,12" font="FdLcD;12" halign="left" noWrap="1">
+		<panel position="bottom" size="*,40">
+			<widget source="session.Event_Now" render="Label" position="220,0" size="100,33" font="FdLcD;33" halign="right" noWrap="1">
 				<convert type="EventTime">Remaining</convert>
 				<convert type="RemainingToText">NoSeconds</convert>
 			</widget>
@@ -52,26 +60,44 @@
   
 <!-- channelselection-->
 	<screen name="ChannelSelection_summary" position="fill">
-		<widget source="parent.ServiceEvent" render="Label" position="top" size="*,21" font="FdLcD;20" halign="left" noWrap="1" >
+		<panel position="top" size="*,70">
+			<widget source="global.CurrentTime" render="Label" position="180,20" size="120,45" font="FdLcD;45" halign="right" valign="top">
+				<convert type="ClockToText">Format:%H:%M</convert>
+			</widget>
+		</panel>
+		<widget source="parent.ServiceEvent" render="Label" position="top" size="*,50" font="FdLcD;42" halign="left" noWrap="1">
 			<convert type="ServiceName">Name</convert>
 		</widget>
-		<widget source="parent.ServiceEvent" render="Label" position="top" size="*,15" font="FdLcD;14" halign="left" noWrap="1">
+		<widget source="parent.ServiceEvent" render="Label" position="top" size="*,70" font="FdLcD;33" halign="left">
 			<convert type="EventName">Name</convert>
 		</widget>
-		<widget source="parent.ServiceEvent" render="Progress" position="top" size="*,4" borderWidth="1">
+		<widget source="parent.ServiceEvent" render="Progress" position="bottom" size="*,14" borderWidth="1">
 			<convert type="EventTime">Progress</convert>
 		</widget>
-		<panel position="bottom" size="*,24" name="SummaryClockPanel" />
 	</screen>
   
 <!-- menus-->
 	<screen name="MenuSummary" position="fill">
-		<widget source="parent.title" render="Label" position="top" size="*,16" font="FdLcD;14" halign="center" valign="top" noWrap="1" />
-		<widget source="parent.menu" render="Label" position="top" size="*,48" font="FdLcD;16" halign="left" valign="top">
+		<widget source="parent.title" render="Label" position="top" size="*,65" font="FdLcD;35" halign="center" valign="top" />
+		<widget source="parent.menu" render="Label" position="top" size="*,90" font="FdLcD;40" halign="center" valign="top">
 			<convert type="StringListSelection" />
 		</widget>
-	</screen>
 
+		<panel position="bottom" size="*,46">
+			<widget source="global.CurrentTime" render="Label" position="180,0" size="120,46" font="FdLcD;45" halign="right" valign="top">
+				<convert type="ClockToText">Format:%H:%M</convert>
+			</widget>
+		</panel>
+	</screen>
+<!-- standby -->
+	<screen name="StandbySummary" position="fill">
+		<widget source="global.CurrentTime" render="Label" position="center,center" size="320,100" font="FdLcD;100" halign="center" valign="center" noWrap="1">
+			<convert type="ClockToText"></convert>
+		</widget>
+		<widget source="session.RecordState" render="FixedLabel" text="Recording" position="4,50" size="120,12" font="FdLcD;12" zPosition="2" valign="bottom" halign="left" noWrap="1">
+			<convert type="ConditionalShowHide"></convert>
+		</widget>
+ 	</screen>
 <!-- movieplayer-->
 	<screen name="InfoBarMoviePlayerSummary" position="fill">
 		<widget source="session.CurrentService" render="Label" position="top" size="*,36" font="FdLcD;16" halign="left" valign="top" >

--- enigma2-nightly/lib/gdi/glcddc.cpp.org	2012-06-09 18:40:05.970115392 +0200
+++ enigma2-nightly/lib/gdi/glcddc.cpp	2012-06-09 18:39:44.154115012 +0200
@@ -4,7 +4,22 @@
 #include <lib/base/init_num.h>
 
 gLCDDC *gLCDDC::instance;
+#ifdef __sh__
+static inline int time_after(struct timespec oldtime, uint32_t delta_ms)
+{
+	// calculate the oldtime + add on the delta
+	uint64_t oldtime_ms = (oldtime.tv_sec * 1000) + (oldtime.tv_nsec / 1000000);
+	oldtime_ms += delta_ms;
+
+	// calculate the nowtime
+	struct timespec nowtime;
+	clock_gettime(CLOCK_MONOTONIC, &nowtime);
+	uint64_t nowtime_ms = (nowtime.tv_sec * 1000) + (nowtime.tv_nsec / 1000000);
 
+	// check
+	return nowtime_ms > oldtime_ms;
+}
+#endif
 gLCDDC::gLCDDC()
 {
 	lcd = new eDBoxLCD();
@@ -22,11 +37,19 @@
 	surface.clut.data=0;
 
 	m_pixmap = new gPixmap(&surface);
+#ifdef __sh__
+	clock_gettime(CLOCK_MONOTONIC, &last_update);
+#endif
 }
 
 gLCDDC::~gLCDDC()
 {
+#ifndef __sh__
+//konfetti: not sure why, but calling the destructor if external lcd (pearl)
+//is selected e2 crashes. this is also true if the destructor does not contain
+//any code !!!
 	delete lcd;
+#endif
 	instance=0;
 }
 
@@ -45,8 +68,17 @@
 		break;
 #endif
 	case gOpcode::flush:
+#ifdef __sh__
+//		if (time_after(last_update, 1500) && update)
+		if (update)
+		{
+			lcd->update();
+			clock_gettime(CLOCK_MONOTONIC, &last_update);
+		}
+#else
 //		if (update)
 			lcd->update();
+#endif
 	default:
 		gDC::exec(o);
 		break;

--- enigma2-nightly/lib/gdi/glcddc.h.org	2012-06-09 18:46:05.898121660 +0200
+++ enigma2-nightly/lib/gdi/glcddc.h	2012-06-09 18:46:14.654121812 +0200
@@ -11,7 +11,9 @@
 	int update;
 	void exec(const gOpcode *opcode);
 	gSurface surface;
-
+#ifdef __sh__    
+	struct timespec last_update;
+#endif
 public:
 	gLCDDC();
 	~gLCDDC();
--- enigma2-nightly/lib/gdi/lcd.cpp.org	2012-06-09 18:47:28.366123096 +0200
+++ enigma2-nightly/lib/gdi/lcd.cpp	2012-06-09 18:51:39.822127475 +0200
@@ -59,7 +59,7 @@
 	}
 }
 #endif
-
+#ifndef __sh__
 eDBoxLCD::eDBoxLCD()
 {
 	int xres=132, yres=64, bpp=8;
@@ -300,4 +300,157 @@
 		}
 	}
 #endif
+#else
+
+void eDBoxLCD::setFlipped(bool onoff)
+{
+	flipped = onoff;
+	update();
+}
+
+/* **************************************************************** */
+/* Pearl LCD */
+
+eDBoxLCD::eDBoxLCD()
+{
+	eDebug("eDBoxLCD::eDBoxLCD >");
+
+	displayNumber = 0;
+	is_oled = 1;
+
+	instance=this;
+
+	if (GLCD::Config.Load("/etc/graphlcd.conf") == false)
+	{
+		eDebug("Error loading config file!\n");
+		return;
+	}
+	if (GLCD::Config.driverConfigs.size() <= 0)
+	{
+		eDebug("ERROR: No displays specified in config file!\n");
+	}
+
+	GLCD::Config.driverConfigs[displayNumber].upsideDown ^= 0;
+	GLCD::Config.driverConfigs[displayNumber].invert ^= 0;
+
+	lcd = GLCD::CreateDriver(GLCD::Config.driverConfigs[displayNumber].id, &GLCD::Config.driverConfigs[displayNumber]);
+
+	if (!lcd)
+	{
+		eDebug("ERROR: Failed creating display object\n");
+		return;
+	}
+	if (lcd->Init() != 0)
+	{
+#if 0
+	// Returning an error here will break the code at various other places
+		eDebug("ERROR: Failed initializing display\n");
+		delete lcd;
+		lcd = NULL;
+		return;
+#endif
+	}
+	lcd->SetBrightness(GLCD::Config.driverConfigs[displayNumber].brightness);
+
+	lcd->GetFeature((std::string) "depth", depth);
+	width = GLCD::Config.driverConfigs[displayNumber].width;
+	height = GLCD::Config.driverConfigs[displayNumber].height;
+
+	eDebug("config -> (w %d, h %d)", width, height);
+
+	bitmap = new GLCD::cBitmap(width, height);
+	bitmap->Clear();
+
+	lcd->SetScreen(bitmap->Data(), bitmap->Width(), bitmap->Height());
+	lcd->Refresh(true);
+
+	lcdfd = 1; //needed for detected()
+	setSize(width, height, depth);
+
+	eDebug("eDBoxLCD::eDBoxLCD (w %d, h %d, depth %d)<", width, height, depth);
+}
+
+void eDBoxLCD::setInverted(unsigned char inv)
+{
+	eDebug("eDBoxLCD::setInverted");
+	inverted = inv;
+	update();
+}
+
+int eDBoxLCD::setLCDContrast(int contrast)
+{
+	eDebug("[LCD] setLCDContrast not supported");
+	return(0);
+}
+
+int eDBoxLCD::setLCDBrightness(int brightness)
+{
+	eDebug("eDBoxLCD::setLCDBrightness");
+/* fixme range check */
+	lcd->SetBrightness(brightness);
+	return(0);
+}
+
+eDBoxLCD::~eDBoxLCD()
+{
+	eDebug("eDBoxLCD::~eDBoxLCD");
+
+/* konfetti: there is an error in graphlcd (I reported it alread)
+ * ->InitSingleDisplay returns 0 if dpf_open fails, which leads
+ * to a crash here!
+	if (lcd)
+	{
+		lcd->DeInit();
+		delete lcd;
+	}
+	if (bitmap)
+		delete bitmap;
+*/
+}
+
+eDBoxLCD *eDBoxLCD::getInstance()
+{
+	eDebug("eDBoxLCD::getInstance");
+	return instance;
+}
+
+void eDBoxLCD::update()
+{
+	if (lcdfd == 1)
+	{
+
+		bitmap->Clear();
+
+		for (int x = 0; x < width; x++)
+			for (int y = 0; y < height; y++)
+			{
+				__u16 *buf16  = (__u16*) _buffer;
+
+#if BYTE_ORDER == LITTLE_ENDIAN
+				__u16 col16   = bswap_16(*((__u16*)(((__u16*)buf16) + y * width + x)));
+#else
+				__u16 col16   = *((__u16*)(((__u16*)buf16) + y  * width + x));
+#endif
+				__u8 red, green, blue, alpha; 
+				__u32 color32;
+
+				/* BBBBB GGGGGG RRRRR */
+				blue  = ((col16 & 0xF800) >> 11) * ( 255 / 31);
+				green = ((col16 & 0x7E0) >> 5) * (255 / 63);
+				red   = (col16 & 0x1f) * (255 / 31);
+				alpha = 255;
+
+				color32 = alpha << 24 | red << 16 | green << 8 | blue;
+
+				if (inverted)
+					color32 = 0xFFFFFF - color32;
+
+				bitmap->DrawPixel(x, y, color32);
+			}
+		lcd->SetScreen(bitmap->Data(), bitmap->Width(), bitmap->Height());
+		lcd->Refresh(false); /* partial update */
+	}
+}
+
+#endif
 }
